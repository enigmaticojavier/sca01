<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="Proyecto">

  <typeAlias alias="Proyecto" type="gob.pe.minam.sca.pojo.Proyecto"/>

  <resultMap id="ProyectoResult" class="Proyecto">
    <result property="pryId" column="PRYID"/>
    <result property="ubigeoId" column="UBIGEOID"/>
    <result property="personaId" column="PERSONAID"/>
    <result property="txtCoordenadas" column="TXTCOORDENADAS"/>
    <result property="clsTipificacion" column="CLSTIPIFICACION"/>
    <result property="txtDescripcion" column="TXTDESCRIPCION"/>
    <result property="mnInversion" column="MNINVERSION"/>
    <result property="clsSector" column="CLSSECTOR"/>
    <result property="clsSubSector" column="CLSSUBSECTOR"/>
    <result property="fchExpediente" column="FCHEXPEDIENTE"/>
    <result property="fchAprobacion" column="FCHAPROBACION"/>
  </resultMap>

  <select id="SelectAllProyectos" resultMap="ProyectoResult">
    select * from PROYECTO
  </select>

  <select id="SelectProyectoById" parameterClass="int" resultClass="Proyecto">
    select * from PROYECTO
    where PRYID = #pryId#
  </select>
   
  <insert id="InsertProyecto" parameterClass="Proyecto">
    insert into PROYECTO (
	 PRYID,
	 UBIGEOID,
	 PERSONAID,
	 TXTCOORDENADAS,
	 CLSTIPIFICACION,
	 TXTDESCRIPCION,
	 MNINVERSION,
	 CLSSECTOR,
	 CLSSUBSECTOR,
	 FCHEXPEDIENTE
  	)values (
     #pryId#,
     #ubigeoId#,
     #personaId#,
     #txtCoordenadas#,
     #clsTipificacion#,
     #txtDescripcion#,
     #mnInversion#,
     #clsSector#,
     #clsSubSector#,
     #fchExpediente#
    )
  </insert>
  
  <parameterMap id="ParametersBuscarProyecto" class="map" >
    <parameter property="p_rsProyecto" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT"/>
    <parameter property="p_cDescripcion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cUbigeoId" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsTipificacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_dFchExpedienteDesde" jdbcType="DATE" javaType="java.util.Date" mode="IN"/>
    <parameter property="p_dFchExpedienteHasta" jdbcType="DATE" javaType="java.util.Date" mode="IN"/>
    <parameter property="p_cEstadoTramite" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipoAcae" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsSector" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsSubSector" jdbcType="NUMBER" javaType="java.lang.Integer" mode="IN"/>
  </parameterMap>
  <procedure id="PQ_PROYECTO.BUSCAR" parameterMap="ParametersBuscarProyecto">
     { call PQ_PROYECTO.BUSCAR(?,?,?,?,?,?,?,?,?,?) }
  </procedure>
  
  <resultMap id="ObtenerProyectoResult" class="Proyecto">
    <result property="pryId" column="PRYID"/>
    <result property="txtDescripcion" column="TXTDESCRIPCION"/>
    <result property="fchExpediente" column="FCHEXPEDIENTE"/>
    <result property="dscClsTipificacion" column="TXTVALOR"/>
    <result property="clsSector" column="CLSSECTOR"/>
    <result property="clsSubSector" column="CLSSUBSECTOR"/>
    <result property="proponente.persona.numDocumentoPer" column="NUMDOCUMENTOPER"/>
    <result property="proponente.persona.txtRazonSocial" column="TXTRAZONSOCIAL"/>
    <result property="proponente.txtNombresRl" column="TXTNOMBRESRL"/>
    <result property="proponente.persona.telefono" column="TELEFONO"/>
    <result property="proponente.persona.txtEmail" column="TXTEMAIL"/>
    <result property="proponente.persona.fax" column="FAX"/>
  </resultMap>
  
  <select id="ObtenerProyecto" resultMap="ObtenerProyectoResult" parameterClass="int">
    select pry.pryid,
           pry.txtdescripcion,
           pry.fchexpediente,
           cat.txtvalor,
           pry.clssector,
           pry.clssubsector,
           per.numdocumentoper,
           per.txtrazonsocial,
           prp.txtnombresrl,
           per.telefono,
           per.txtemail,
           per.fax
    from proyecto pry, parametro cat, proponente prp, persona per
    where pry.clstipificacion = cat.codparametro(+) and cat.tipparametro(+)='IGA'
    and pry.personaid = prp.personaid and prp.personaid = per.personaid
    and pry.pryid=#param#
  </select>
  
  <parameterMap id="ParametersRanking" class="map" >
    <parameter property="p_rsProyecto" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT"/>
    <parameter property="p_cClsTipificacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cEstadoTramite" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipoPersoneria" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cProponente" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipoAcae" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsSector" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsSubSector" jdbcType="NUMBER" javaType="java.lang.Integer" mode="IN"/>
    <parameter property="p_cCodDepartamento" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cCodProvincia" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cCodDistrito" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cAnoPresentacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipDocTramite" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_nOrdenRanking" jdbcType="NUMBER" javaType="java.lang.Integer" mode="IN"/>
  </parameterMap>
  
  <procedure id="PQ_PROYECTO.RANKING" parameterMap="ParametersRanking">   
    { call PQ_PROYECTO.RANKING(?,?,?,?,?,?,?,?,?,?,?,?,?,?) }
  </procedure>  
  
  <parameterMap id="ParametersRankingDetalle" class="map" >
    <parameter property="p_rsProyecto" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT"/>
    <parameter property="p_cClsTipificacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cEstadoTramite" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipoPersoneria" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cProponente" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipoAcae" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsSector" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cClsSubSector" jdbcType="NUMBER" javaType="java.lang.Integer" mode="IN"/>
    <parameter property="p_cCodDepartamento" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cCodProvincia" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cCodDistrito" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cAnoPresentacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_cTipDocTramite" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
    <parameter property="p_nOrdenRanking" jdbcType="NUMBER" javaType="java.lang.Integer" mode="IN"/>
    <parameter property="p_cIdAgrupacion" jdbcType="VARCHAR" javaType="java.lang.String" mode="IN"/>
  </parameterMap>
  <procedure id="PQ_PROYECTO.RANKING_DETALLE" parameterMap="ParametersRankingDetalle">
     { call PQ_PROYECTO.RANKING_DETALLE(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) }
  </procedure>
  
  
</sqlMap>