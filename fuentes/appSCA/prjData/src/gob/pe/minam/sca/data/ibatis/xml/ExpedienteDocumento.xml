<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ExpedienteDocumento">

  <typeAlias alias="ExpedienteDocumento" type="gob.pe.minam.sca.pojo.ExpedienteDocumento"/>
  
  <resultMap id="ExpedienteDocumentoXProyectoResult" class="ExpedienteDocumento">
      <result property="expedientePaso.expediente.expId" column="expid"/>
      <result property="expedientePaso.nsecuencia" column="nsecuencia"/>
      <result property="documento.docId" column="docid"/>
      <result property="expedientePaso.expediente.numExpediente" column="numexpediente"/>
      <result property="expedientePaso.expediente.fchExpediente" column="fchexpediente"/>
      <result property="documento.dscTipoDocumento" column="txtvalor"/>
      <result property="documento.codDocumento" column="coddocumento"/>
      <result property="expedientePaso.dscTipPaso" column="dsctippas"/>
      
  </resultMap>
  
  <resultMap id="ExpedienteDocumentoXPeriodoPersonaResult" class="ExpedienteDocumento">
      <result property="expedientePaso.expediente.expId" column="expid"/>
      <result property="expedientePaso.nsecuencia" column="nsecuencia"/>
      <result property="documento.docId" column="docid"/>
      <result property="expedientePaso.expediente.proyecto.pryId" column="pryid"/>
      <result property="expedientePaso.expediente.proyecto.txtDescripcion" column="txtdescripcion"/>
      <result property="expedientePaso.tipPaso" column="tippaso"/>
      <result property="expedientePaso.fchPaso" column="fchpaso"/>
      <result property="expedientePaso.expediente.numExpediente" column="numexpediente"/>
      <result property="expedientePaso.expediente.fchExpediente" column="fchexpediente"/>
      <result property="documento.dscTipoDocumento" column="txtvalor"/>
      <result property="documento.codDocumento" column="coddocumento"/>
      <result property="documento.tipoDocumento" column="tipodocumento"/>
  </resultMap>
  
  <select id="BuscarExpDocXPry" resultMap="ExpedienteDocumentoXProyectoResult" parameterClass="int">
        select ep.expid, ep.nsecuencia, doc.docid, ex.numexpediente, 
             ex.fchexpediente, tdo.txtvalor, doc.coddocumento,
             tippas.txtvalor dsctippas
        from expediente ex, expedientepaso ep, expedientedocumento ed, documento doc, parametro tdo, parametro tippas
        where ex.expid = ep.expid and ep.tippaso=tippas.codparametro and tippas.tipparametro='TRX'
        and ep.expid = ed.expid(+) and ep.nsecuencia = ed.nsecuencia(+)
        and ed.docid = doc.docid(+) and doc.tipodocumento = tdo.codparametro(+) and  tdo.tipparametro(+) = 'DOC'
        and ex.pryId=#param#
        order by ex.expid, ep.nsecuencia, tdo.txtvalor
  </select>
  
  <select id="BuscarExpDocXPryLogout" resultMap="ExpedienteDocumentoXProyectoResult" parameterClass="int">
        select ep.expid, ep.nsecuencia, doc.docid, ex.numexpediente, 
             ex.fchexpediente, tdo.txtvalor, doc.coddocumento,
             tippas.txtvalor dsctippas
        from expediente ex, expedientepaso ep, expedientedocumento ed, documento doc, parametro tdo, parametro tippas
        where ex.expid = ep.expid and ep.tippaso=tippas.codparametro and tippas.tipparametro='TRX'
        and ep.expid = ed.expid(+) and ep.nsecuencia = ed.nsecuencia(+)
        and ed.docid = doc.docid(+) and doc.tipodocumento = tdo.codparametro(+) and  tdo.tipparametro(+) = 'DOC'
        and tippas.codparametro in (select codparametro from parametro tippas where tippas.tipparametro='TXU')
        and ex.pryId=#param#
        order by ex.expid, ep.nsecuencia, tdo.txtvalor
  </select>
  
  
  <select id="BuscarExpDocXPeriodoPersonaId" resultMap="ExpedienteDocumentoXPeriodoPersonaResult" parameterClass="ExpedienteDocumento">
        select ep.expid, ep.nsecuencia, doc.docid, pry.pryid,
               pry.txtdescripcion, ep.tippaso, ep.fchpaso, ex.numexpediente,
               ex.fchexpediente, tdo.txtvalor, doc.coddocumento, doc.tipodocumento
        from expediente ex, expedientepaso ep, expedientedocumento ed,
             documento doc, parametro tdo, proyecto pry
        where ex.expid = ep.expid
           and ep.expid = ed.expid(+)
           and ep.nsecuencia = ed.nsecuencia(+)
           and ed.docid = doc.docid(+)
           and doc.tipodocumento = tdo.codparametro(+)
           and tdo.tipparametro(+) = 'DOC'
           and ex.pryid = pry.pryid
           and ex.personaid = #expedientePaso.expediente.personaId# 
           and ep.periodo = #expedientePaso.periodo# 
        order by ex.expid, ep.nsecuencia, tdo.txtvalor   
  </select>
  
</sqlMap>