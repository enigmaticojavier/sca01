<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ExpedienteDocumento">

  <typeAlias alias="ExpedienteDocumento" type="gob.pe.minam.sca.pojo.ExpedienteDocumento"/>
  
  <resultMap id="ExpedienteDocumentoXProyectoResult" class="ExpedienteDocumento">
      <result property="expedientePaso.expediente.expId" column="expid"/>
      <result property="expedientePaso.nsecuencia" column="nsecuencia"/>
      <result property="documento.docId" column="docid"/>
      <result property="expedientePaso.expediente.numExpediente" column="numexpediente"/>
      <result property="expedientePaso.expediente.fchExpediente" column="fchexpediente"/>
      <result property="expedientePaso.dscTipPaso" column="dscTipPaso"/>
      <result property="documento.dscTipoDocumento" column="txtvalor"/>
      <result property="documento.codDocumento" column="coddocumento"/>
  </resultMap>
  
  <select id="BUSCAREXPDOCXPRY" resultMap="ExpedienteDocumentoXProyectoResult" parameterClass="int">
      select ep.expid, ep.nsecuencia, doc.docid, ex.numexpediente, 
             ex.fchexpediente, tdo.txtvalor, doc.coddocumento
      from expediente ex, expedientepaso ep, expedientedocumento ed, documento doc, parametro tdo
      where ex.expid = ep.expid and ep.expid = ed.expid(+) and ep.nsecuencia = ed.nsecuencia(+)
      and ed.docid = doc.docid(+) and doc.tipodocumento = tdo.codparametro(+) and  tdo.tipparametro(+) = 'DOC'
      and ex.pryId=#param#
  </select>
</sqlMap>